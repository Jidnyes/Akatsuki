<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<!-- Leaflet JavaScript -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NAGAR-SEVA ‚Äì Admin Dashboard | Borivali Municipal</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,400..700;1,14..32,400..700&display=swap" rel="stylesheet"/>
  <style>
    /* ===== LIGHT GOVERNMENT THEME ===== */
    :root {
      --color-primary: #2563EB;        /* Soft Blue */
      --color-secondary: #DBEAFE;       /* Light Sky Blue */
      --color-background: #F8FAFC;      /* Off White */
      --color-card: #FFFFFF;             /* Pure White */
      --color-text-primary: #0F172A;     /* Dark Navy */
      --color-text-secondary: #475569;   /* Slate Grey */
      --color-success: #22C55E;          /* Soft Green */
      --color-warning: #F59E0B;          /* Amber */
      --color-critical: #EF4444;         /* Soft Red */

      --border-light: #E2E8F0;
      --border-medium: #CBD5E1;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      --radius: 12px;
      --radius-sm: 8px;

      --sidebar-w: 256px;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Inter', sans-serif;
      background: var(--color-background);
      color: var(--color-text-primary);
      display: flex;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* ===== LOGIN SCREEN (light theme) ===== */
    .login-screen {
      position: fixed; inset: 0; z-index: 9999;
      background: var(--color-background);
      display: flex; align-items: center; justify-content: center;
    }
    .login-bg {
      position: absolute; inset: 0;
      background: radial-gradient(ellipse 80% 60% at 50% 0%, var(--color-secondary) 0%, transparent 70%);
    }
    .login-grid-lines {
      position: absolute; inset: 0; overflow: hidden;
      background-image: linear-gradient(var(--border-light) 1px, transparent 1px),
        linear-gradient(90deg, var(--border-light) 1px, transparent 1px);
      background-size: 40px 40px;
    }
    .login-card {
      position: relative; z-index: 1;
      background: var(--color-card);
      border: 1px solid var(--border-medium);
      border-radius: 20px;
      padding: 48px 40px;
      width: 100%; max-width: 420px;
      box-shadow: var(--shadow-lg);
    }
    .login-logo { display: flex; align-items: center; gap: 12px; margin-bottom: 32px; }
    .login-emblem {
      width: 52px; height: 52px; border-radius: 14px;
      background: var(--color-primary);
      display: flex; align-items: center; justify-content: center;
      font-size: 24px; color: white;
      box-shadow: 0 0 0 2px var(--color-secondary);
    }
    .login-brand { line-height: 1.1; }
    .login-brand-name { font-weight: 800; font-size: 1.2rem; color: var(--color-text-primary); }
    .login-brand-sub { font-size: 0.72rem; color: var(--color-text-secondary); letter-spacing: 0.06em; text-transform: uppercase; }
    .login-title { font-weight: 700; font-size: 1.5rem; margin-bottom: 6px; color: var(--color-text-primary); }
    .login-subtitle { font-size: 0.88rem; color: var(--color-text-secondary); margin-bottom: 28px; }
    .login-field { margin-bottom: 16px; }
    .login-label { display: block; font-size: 0.82rem; font-weight: 600; color: var(--color-text-secondary); margin-bottom: 8px; letter-spacing: 0.04em; text-transform: uppercase; }
    .login-input {
      width: 100%; padding: 12px 16px;
      background: var(--color-card); border: 1px solid var(--border-medium);
      border-radius: var(--radius-sm);
      color: var(--color-text-primary); font-size: 0.95rem;
      outline: none; transition: all 0.2s;
    }
    .login-input:focus { border-color: var(--color-primary); box-shadow: 0 0 0 3px var(--color-secondary); }
    .login-input::placeholder { color: var(--color-text-secondary); opacity: 0.6; }
    .login-role { display: flex; gap: 8px; margin-bottom: 20px; }
    .role-btn {
      flex: 1; padding: 10px; border-radius: var(--radius-sm);
      border: 1px solid var(--border-medium);
      font-size: 0.82rem; font-weight: 600;
      color: var(--color-text-secondary); background: var(--color-card); cursor: pointer;
      transition: all 0.2s; text-align: center;
    }
    .role-btn.active { border-color: var(--color-primary); background: var(--color-secondary); color: var(--color-primary); }
    .login-btn {
      width: 100%; padding: 13px;
      background: var(--color-primary);
      color: white; border: none; border-radius: var(--radius-sm);
      font-weight: 700; font-size: 1rem;
      cursor: pointer; transition: all 0.2s;
      box-shadow: 0 4px 10px rgba(37,99,235,0.3);
    }
    .login-btn:hover { background: #1D4ED8; transform: translateY(-1px); box-shadow: 0 8px 16px rgba(37,99,235,0.4); }
    .login-hint { margin-top: 16px; text-align: center; font-size: 0.78rem; color: var(--color-text-secondary); }
    .login-hint span { color: var(--color-primary); font-weight: 600; cursor: pointer; }

    /* ===== SIDEBAR (light) ===== */
    .sidebar {
      width: var(--sidebar-w); min-height: 100vh;
      background: var(--color-secondary);
      border-right: 1px solid var(--border-light);
      position: fixed; top: 0; left: 0; bottom: 0;
      display: flex; flex-direction: column;
      z-index: 100; overflow-y: auto;
      transition: transform 0.3s;
    }
    .sidebar-header {
      padding: 20px 20px 16px;
      border-bottom: 1px solid var(--border-light);
      background: var(--color-card);
    }
    .sidebar-logo { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; }
    .sidebar-emblem {
      width: 38px; height: 38px; border-radius: 10px;
      background: var(--color-primary);
      display: flex; align-items: center; justify-content: center; font-size: 18px; color: white;
      box-shadow: 0 0 0 2px var(--color-secondary);
    }
    .sidebar-brand { font-weight: 800; font-size: 1rem; color: var(--color-text-primary); }
    .sidebar-brand-sub { font-size: 0.65rem; color: var(--color-text-secondary); letter-spacing: 0.06em; text-transform: uppercase; }
    .admin-profile {
      display: flex; align-items: center; gap: 10px;
      padding: 12px 14px;
      background: var(--color-card); border-radius: var(--radius-sm);
      border: 1px solid var(--border-light);
    }
    .admin-avatar {
      width: 36px; height: 36px; border-radius: 50%;
      background: var(--color-primary);
      display: flex; align-items: center; justify-content: center; font-size: 16px; color: white;
      flex-shrink: 0; font-weight: 700;
    }
    .admin-name { font-weight: 600; font-size: 0.85rem; color: var(--color-text-primary); line-height: 1.2; }
    .admin-role { font-size: 0.7rem; color: var(--color-primary); font-weight: 600; }
    .online-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--color-success); margin-left: auto; box-shadow: 0 0 6px var(--color-success); }

    .sidebar-nav { flex: 1; padding: 12px 12px; }
    .nav-section-label { font-size: 0.65rem; font-weight: 700; letter-spacing: 0.12em; text-transform: uppercase; color: var(--color-text-secondary); padding: 8px 8px 4px; }
    .nav-item {
      display: flex; align-items: center; gap: 10px;
      padding: 10px 12px; border-radius: var(--radius-sm);
      font-size: 0.88rem; font-weight: 500; color: var(--color-text-primary);
      cursor: pointer; transition: all 0.18s; margin-bottom: 2px;
      position: relative;
    }
    .nav-item:hover { background: var(--color-card); color: var(--color-text-primary); }
    .nav-item.active { background: var(--color-card); color: var(--color-primary); border: 1px solid var(--border-light); font-weight: 600; }
    .nav-item .nav-icon { font-size: 16px; width: 20px; text-align: center; color: var(--color-text-secondary); }
    .nav-badge { margin-left: auto; background: var(--color-critical); color: white; font-size: 0.65rem; font-weight: 700; padding: 2px 6px; border-radius: 10px; }
    .nav-badge.green { background: var(--color-success); }
    .nav-badge.yellow { background: var(--color-warning); }
    .sidebar-footer {
      padding: 12px; border-top: 1px solid var(--border-light);
      background: var(--color-card);
    }
    .logout-btn {
      width: 100%; padding: 10px 12px;
      background: var(--color-card); border: 1px solid var(--border-medium);
      border-radius: var(--radius-sm); color: var(--color-text-primary);
      font-weight: 600; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 8px;
    }
    .logout-btn:hover { background: var(--color-secondary); }

    /* ===== MAIN CONTENT ===== */
    .main {
      margin-left: var(--sidebar-w);
      flex: 1; min-height: 100vh;
      display: flex; flex-direction: column;
    }

    /* ===== TOPBAR ===== */
    .topbar {
      background: var(--color-card); border-bottom: 1px solid var(--border-light);
      padding: 0 24px; height: 60px;
      display: flex; align-items: center; justify-content: space-between;
      position: sticky; top: 0; z-index: 90;
    }
    .topbar-left { display: flex; align-items: center; gap: 12px; }
    .page-title { font-weight: 700; font-size: 1.05rem; color: var(--color-text-primary); }
    .breadcrumb { font-size: 0.8rem; color: var(--color-text-secondary); }
    .breadcrumb span { color: var(--color-text-primary); }
    .topbar-right { display: flex; align-items: center; gap: 10px; }
    .tb-btn {
      width: 36px; height: 36px; border-radius: 8px;
      background: var(--color-card); border: 1px solid var(--border-light);
      display: flex; align-items: center; justify-content: center;
      font-size: 16px; cursor: pointer; transition: all 0.2s; position: relative;
      color: var(--color-text-secondary);
    }
    .tb-btn:hover { background: var(--color-secondary); border-color: var(--border-medium); }
    .tb-notif-dot { position: absolute; top: 6px; right: 7px; width: 7px; height: 7px; background: var(--color-critical); border-radius: 50%; border: 1px solid var(--color-card); }
    .search-box {
      display: flex; align-items: center; gap: 8px;
      background: var(--color-card); border: 1px solid var(--border-light);
      border-radius: var(--radius-sm); padding: 6px 12px;
      width: 220px;
    }
    .search-box input { background: none; border: none; outline: none; color: var(--color-text-primary); font-size: 0.85rem; width: 100%; }
    .search-box input::placeholder { color: var(--color-text-secondary); opacity: 0.6; }
    .mobile-menu-btn { display: none; background: var(--color-card); border: 1px solid var(--border-light); border-radius: 8px; padding: 8px; cursor: pointer; font-size: 18px; color: var(--color-text-secondary); }
    /* language dropdown */
    .lang-select {
      border: 1px solid var(--border-light);
      background: var(--color-card);
      color: var(--color-text-primary);
      border-radius: var(--radius-sm);
      padding: 4px 8px;
      font-size: 0.8rem;
      cursor: pointer;
      outline: none;
    }

    /* ===== CONTENT ===== */
    .content { padding: 24px; flex: 1; }
    .panel { display: none; }
    .panel.active { display: block; }

    /* ===== KPI CARDS ===== */
    .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px; }
    .kpi-card {
      background: var(--color-card); border: 1px solid var(--border-light);
      border-radius: var(--radius); padding: 20px;
      transition: all 0.2s; cursor: default; position: relative; overflow: hidden;
      box-shadow: var(--shadow);
    }
    .kpi-card:hover { border-color: var(--border-medium); transform: translateY(-2px); box-shadow: var(--shadow-lg); }
    .kpi-top { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
    .kpi-icon { width: 42px; height: 42px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; background: var(--color-secondary); color: var(--color-primary); }
    .kpi-change { font-size: 0.75rem; font-weight: 700; padding: 3px 8px; border-radius: 6px; }
    .kpi-change.up { background: #E6F7E6; color: var(--color-success); }
    .kpi-change.down { background: #FFEBEE; color: var(--color-critical); }
    .kpi-number { font-weight: 800; font-size: 2rem; color: var(--color-text-primary); line-height: 1; }
    .kpi-label { font-size: 0.8rem; color: var(--color-text-secondary); margin-top: 4px; }
    .kpi-sub { font-size: 0.72rem; color: var(--color-text-secondary); margin-top: 6px; }

    /* ===== CHARTS ===== */
    .charts-row { display: grid; grid-template-columns: 2fr 1fr; gap: 16px; margin-bottom: 24px; }
    .chart-card {
      background: var(--color-card); border: 1px solid var(--border-light);
      border-radius: var(--radius); padding: 20px;
      box-shadow: var(--shadow);
    }
    .card-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
    .card-title { font-weight: 700; font-size: 0.95rem; color: var(--color-text-primary); }
    .card-subtitle { font-size: 0.78rem; color: var(--color-text-secondary); margin-top: 2px; }
    .card-actions { display: flex; gap: 6px; }
    .chip {
      padding: 4px 10px; border-radius: 6px;
      font-size: 0.75rem; font-weight: 600; cursor: pointer;
      border: 1px solid var(--border-light); color: var(--color-text-secondary); background: var(--color-card);
      transition: all 0.2s;
    }
    .chip.active { background: var(--color-secondary); border-color: var(--color-primary); color: var(--color-primary); }

    /* bar chart (colors adapted) */
    .bar-chart { display: flex; align-items: flex-end; gap: 8px; height: 160px; padding-top: 10px; }
    .bar-group { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 4px; }
    .bar-track { flex: 1; display: flex; align-items: flex-end; width: 100%; }
    .bar {
      width: 100%; border-radius: 4px 4px 0 0;
      background: var(--color-primary);
      position: relative; cursor: pointer;
      transition: opacity 0.2s, transform 0.2s;
      animation: barGrow 0.8s ease-out both;
    }
    .bar:hover { opacity: 0.85; transform: scaleY(1.03); transform-origin: bottom; }
    .bar.blue { background: var(--color-secondary); } /* secondary for resolved */
    @keyframes barGrow { from{ transform: scaleY(0); } to{ transform: scaleY(1); } }
    .bar-label { font-size: 0.68rem; color: var(--color-text-secondary); font-weight: 600; }
    .bar-val { font-size: 0.72rem; color: var(--color-text-secondary); font-weight: 700; }

    /* donut */
    .donut-wrap { display: flex; align-items: center; justify-content: center; margin-bottom: 16px; position: relative; }
    .donut-center { position: absolute; text-align: center; }
    .donut-center-num { font-weight: 800; font-size: 1.6rem; color: var(--color-text-primary); }
    .donut-center-label { font-size: 0.7rem; color: var(--color-text-secondary); }
    .donut-legend { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; }
    .legend-item { display: flex; align-items: center; gap: 6px; font-size: 0.78rem; }
    .legend-dot { width: 8px; height: 8px; border-radius: 2px; flex-shrink: 0; }
    .legend-name { color: var(--color-text-secondary); flex: 1; }
    .legend-pct { color: var(--color-text-primary); font-weight: 700; }

    /* ===== TABLES ===== */
    .table-section { margin-bottom: 24px; }
    .table-card {
      background: var(--color-card); border: 1px solid var(--border-light);
      border-radius: var(--radius); overflow: hidden;
      box-shadow: var(--shadow);
    }
    .table-toolbar {
      padding: 16px 20px;
      border-bottom: 1px solid var(--border-light);
      display: flex; align-items: center; gap: 12px; flex-wrap: wrap;
    }
    .filter-tabs { display: flex; gap: 4px; }
    .filter-tab {
      padding: 6px 12px; border-radius: 6px;
      font-size: 0.8rem; font-weight: 600; cursor: pointer;
      border: 1px solid var(--border-light); color: var(--color-text-secondary);
      transition: all 0.18s;
    }
    .filter-tab.active { background: var(--color-secondary); border-color: var(--color-primary); color: var(--color-primary); }
    .filter-tab:hover:not(.active) { background: var(--color-secondary); }
    .tb-search { display: flex; align-items: center; gap: 8px; background: var(--color-card); border: 1px solid var(--border-light); border-radius: 6px; padding: 6px 12px; margin-left: auto; }
    .tb-search input { background: none; border: none; outline: none; color: var(--color-text-primary); font-size: 0.82rem; width: 180px; }
    .tb-search input::placeholder { color: var(--color-text-secondary); opacity: 0.6; }
    table { width: 100%; border-collapse: collapse; }
    th { padding: 12px 20px; text-align: left; font-size: 0.72rem; font-weight: 700; letter-spacing: 0.08em; text-transform: uppercase; color: var(--color-text-secondary); background: var(--color-secondary); border-bottom: 1px solid var(--border-light); }
    td { padding: 14px 20px; border-bottom: 1px solid var(--border-light); font-size: 0.85rem; vertical-align: middle; color: var(--color-text-primary); }
    tr:hover td { background: var(--color-secondary); }
    tr:last-child td { border-bottom: none; }
    .complaint-id { font-weight: 700; font-size: 0.8rem; color: var(--color-primary); }
    .complaint-title { font-weight: 500; color: var(--color-text-primary); max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .complaint-loc { color: var(--color-text-secondary); font-size: 0.8rem; }
    .cat-tag { display: inline-flex; align-items: center; gap: 5px; padding: 3px 8px; border-radius: 5px; font-size: 0.75rem; font-weight: 600; background: var(--color-secondary); color: var(--color-text-primary); }
    .status-pill { display: inline-flex; align-items: center; gap: 5px; padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: 700; }
    .status-pill.reported { background: #DBEAFE; color: var(--color-primary); }
    .status-pill.assigned { background: #FEF3C7; color: var(--color-warning); }
    .status-pill.progress { background: #E9D5FF; color: #9333EA; }
    .status-pill.resolved { background: #E6F7E6; color: var(--color-success); }
    .status-pill.emergency { background: #FFEBEE; color: var(--color-critical); }
    .priority-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; }
    .priority-dot.high { background: var(--color-critical); box-shadow: 0 0 6px var(--color-critical); }
    .priority-dot.medium { background: var(--color-warning); }
    .priority-dot.low { background: var(--color-success); }
    .action-btn { padding: 5px 10px; border-radius: 5px; font-size: 0.75rem; font-weight: 600; cursor: pointer; transition: all 0.15s; border: 1px solid; background: transparent; }
    .action-btn.view { color: var(--color-primary); border-color: var(--color-primary); }
    .action-btn.assign { color: var(--color-text-primary); border-color: var(--border-medium); background: var(--color-secondary); }
    .action-btn.view:hover { background: var(--color-secondary); }
    .action-btn.assign:hover { background: var(--color-card); }

    /* ===== PROFILES ===== */
    .profiles-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
    .profile-card {
      background: var(--color-card); border: 1px solid var(--border-light);
      border-radius: var(--radius); overflow: hidden;
      transition: all 0.25s; cursor: pointer;
      box-shadow: var(--shadow);
    }
    .profile-card:hover { border-color: var(--border-medium); transform: translateY(-3px); box-shadow: var(--shadow-lg); }
    .profile-header {
      padding: 24px 20px;
      background: var(--color-secondary);
      display: flex; align-items: center; gap: 14px;
      border-bottom: 1px solid var(--border-light);
      position: relative;
    }
    .profile-header::before {
      content: '';
      position: absolute; top: 0; left: 0; right: 0; height: 3px;
      background: var(--profile-color, var(--color-primary));
    }
    .profile-avatar {
      width: 64px; height: 64px; border-radius: 50%;
      background: var(--profile-color, var(--color-primary));
      display: flex; align-items: center; justify-content: center;
      font-size: 28px; flex-shrink: 0; color: white;
      border: 3px solid var(--color-card);
    }
    .profile-info { flex: 1; }
    .profile-name { font-weight: 700; font-size: 1rem; color: var(--color-text-primary); }
    .profile-desig { font-size: 0.78rem; color: var(--color-text-secondary); margin-top: 2px; }
    .profile-ward { font-size: 0.72rem; color: var(--color-primary); font-weight: 600; margin-top: 3px; }
    .profile-status { width: 10px; height: 10px; border-radius: 50%; background: var(--color-success); box-shadow: 0 0 8px var(--color-success); position: absolute; top: 20px; right: 20px; }
    .profile-body { padding: 16px 20px; }
    .profile-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 14px; }
    .ps-item { text-align: center; padding: 10px 6px; background: var(--color-secondary); border-radius: 8px; border: 1px solid var(--border-light); }
    .ps-num { font-weight: 800; font-size: 1.1rem; color: var(--color-text-primary); line-height: 1; }
    .ps-label { font-size: 0.65rem; color: var(--color-text-secondary); margin-top: 3px; }
    .profile-progress { margin-bottom: 14px; }
    .progress-label { display: flex; justify-content: space-between; font-size: 0.78rem; margin-bottom: 6px; }
    .progress-label span { color: var(--color-text-secondary); }
    .progress-label strong { color: var(--color-text-primary); }
    .progress-bar-track { height: 6px; background: var(--border-light); border-radius: 3px; overflow: hidden; }
    .progress-bar-fill { height: 100%; border-radius: 3px; background: var(--profile-color, var(--color-primary)); transition: width 1.2s ease; }
    .profile-meta { display: flex; flex-direction: column; gap: 6px; }
    .profile-meta-row { display: flex; align-items: center; gap: 8px; font-size: 0.8rem; color: var(--color-text-secondary); }
    .profile-meta-row span { font-size: 13px; }
    .profile-actions { display: flex; gap: 8px; margin-top: 14px; }
    .profile-btn { flex: 1; padding: 8px; border-radius: 7px; font-size: 0.8rem; font-weight: 600; cursor: pointer; transition: all 0.2s; border: 1px solid; text-align: center; background: transparent; }
    .profile-btn.primary { background: var(--color-secondary); color: var(--color-primary); border-color: var(--color-primary); }
    .profile-btn.secondary { background: var(--color-card); color: var(--color-text-primary); border-color: var(--border-medium); }
    .profile-btn:hover { opacity: 0.85; }

    /* ===== BEFORE/AFTER ===== */
    .before-after-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; }
    .ba-card {
      background: var(--color-card); border: 1px solid var(--border-light);
      border-radius: var(--radius); overflow: hidden;
      box-shadow: var(--shadow);
    }
    .ba-header { padding: 14px 16px; border-bottom: 1px solid var(--border-light); display: flex; align-items: center; justify-content: space-between; }
    .ba-title { font-weight: 700; font-size: 0.88rem; color: var(--color-text-primary); }
    .ba-meta { font-size: 0.75rem; color: var(--color-text-secondary); }
    .ba-resolved { background: #E6F7E6; color: var(--color-success); padding: 3px 8px; border-radius: 5px; font-size: 0.72rem; font-weight: 700; }
    .slider-container { position: relative; height: 200px; overflow: hidden; cursor: ew-resize; user-select: none; }
    .slider-before, .slider-after { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; font-size: 60px; }
    .slider-before { background: linear-gradient(135deg, #F1F5F9 0%, #E2E8F0 100%); clip-path: inset(0 50% 0 0); transition: clip-path 0.1s; }
    .slider-after { background: linear-gradient(135deg, #E6F7E6 0%, #D1FAE5 100%); }
    .slider-label {
      position: absolute; top: 10px;
      padding: 4px 10px; border-radius: 5px; font-size: 0.72rem; font-weight: 700;
    }
    .label-before { left: 10px; background: var(--color-secondary); color: var(--color-text-primary); }
    .label-after { right: 10px; background: var(--color-success); color: white; }
    .slider-divider { position: absolute; top: 0; bottom: 0; width: 3px; background: white; left: 50%; transform: translateX(-50%); cursor: ew-resize; }
    .slider-handle {
      position: absolute; top: 50%; left: 50%;
      width: 36px; height: 36px; border-radius: 50%;
      background: white; transform: translate(-50%, -50%);
      display: flex; align-items: center; justify-content: center;
      font-size: 14px; box-shadow: 0 2px 12px rgba(0,0,0,0.2);
      cursor: ew-resize; border: 1px solid var(--border-medium);
    }
    .ba-footer { padding: 12px 16px; display: flex; align-items: center; justify-content: space-between; border-top: 1px solid var(--border-light); }
    .ba-officer { display: flex; align-items: center; gap: 8px; font-size: 0.8rem; color: var(--color-text-secondary); }
    .ba-officer-dot { width: 24px; height: 24px; border-radius: 50%; background: var(--color-primary); display: flex; align-items: center; justify-content: center; font-size: 11px; color: white; }
    .ba-date { font-size: 0.75rem; color: var(--color-text-secondary); }

    /* ===== HEATMAP ===== */
    .heatmap-grid-container { display: flex; gap: 16px; margin-top: 8px; }
    .heatmap-areas { flex: 1; display: grid; grid-template-columns: repeat(6, 1fr); gap: 4px; }
    .hm-cell {
      aspect-ratio: 1; border-radius: 4px;
      display: flex; align-items: center; justify-content: center;
      font-size: 0.6rem; font-weight: 700; cursor: pointer;
      transition: all 0.15s; color: var(--color-text-primary);
      background: var(--color-secondary);
      border: 1px solid var(--border-light);
    }
    .hm-cell:hover { transform: scale(1.1); z-index: 1; background: var(--color-primary); color: white; }
    .heatmap-legend { display: flex; flex-direction: column; gap: 4px; justify-content: center; padding: 4px 0; }
    .hm-leg-item { display: flex; align-items: center; gap: 6px; font-size: 0.7rem; color: var(--color-text-secondary); }
    .hm-leg-color { width: 12px; height: 12px; border-radius: 2px; }

    /* ===== PERFORMANCE ===== */
    .perf-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 16px; }
    .officer-list { display: flex; flex-direction: column; gap: 8px; }
    .officer-row {
      display: flex; align-items: center; gap: 12px;
      padding: 12px 14px; background: var(--color-card);
      border-radius: var(--radius-sm); border: 1px solid var(--border-light);
      transition: all 0.2s;
    }
    .officer-row:hover { border-color: var(--border-medium); }
    .officer-rank { font-weight: 800; font-size: 1.1rem; min-width: 28px; color: var(--color-text-secondary); }
    .officer-rank.r1 { color: var(--color-warning); }
    .officer-rank.r2 { color: var(--color-text-secondary); }
    .officer-rank.r3 { color: var(--color-primary); }
    .officer-av { width: 36px; height: 36px; border-radius: 50%; background: var(--color-secondary); display: flex; align-items: center; justify-content: center; font-size: 16px; flex-shrink: 0; color: var(--color-primary); }
    .officer-info { flex: 1; }
    .officer-name { font-weight: 600; font-size: 0.88rem; color: var(--color-text-primary); }
    .officer-ward { font-size: 0.72rem; color: var(--color-text-secondary); }
    .officer-bar-wrap { flex: 1; }
    .officer-bar { height: 6px; border-radius: 3px; background: var(--color-primary); }
    .officer-pct { font-weight: 700; font-size: 0.88rem; color: var(--color-primary); min-width: 40px; text-align: right; }

    /* ===== MODAL ===== */
    .modal-overlay {
      position: fixed; inset: 0; z-index: 999;
      background: rgba(0,0,0,0.5); backdrop-filter: blur(2px);
      display: flex; align-items: center; justify-content: center;
      padding: 24px; opacity: 0; pointer-events: none; transition: opacity 0.25s;
    }
    .modal-overlay.open { opacity: 1; pointer-events: all; }
    .modal {
      background: var(--color-card); border: 1px solid var(--border-medium);
      border-radius: 20px; width: 100%; max-width: 560px;
      box-shadow: var(--shadow-lg); transform: scale(0.95); transition: transform 0.25s;
      max-height: 90vh; overflow-y: auto;
    }
    .modal-overlay.open .modal { transform: scale(1); }
    .modal-header { padding: 20px 24px; border-bottom: 1px solid var(--border-light); display: flex; align-items: center; justify-content: space-between; }
    .modal-title { font-weight: 700; font-size: 1rem; color: var(--color-text-primary); }
    .modal-close { width: 32px; height: 32px; border-radius: 8px; background: var(--color-card); display: flex; align-items: center; justify-content: center; cursor: pointer; color: var(--color-text-secondary); font-size: 16px; transition: all 0.2s; border: 1px solid var(--border-light); }
    .modal-close:hover { background: var(--color-secondary); color: var(--color-text-primary); }
    .modal-body { padding: 24px; }
    .detail-row { display: flex; gap: 8px; margin-bottom: 14px; align-items: flex-start; }
    .detail-label { font-size: 0.78rem; color: var(--color-text-secondary); font-weight: 600; text-transform: uppercase; letter-spacing: 0.06em; min-width: 100px; padding-top: 2px; }
    .detail-val { font-size: 0.88rem; color: var(--color-text-primary); flex: 1; }
    .assign-select { width: 100%; padding: 10px 12px; background: var(--color-card); border: 1px solid var(--border-medium); border-radius: var(--radius-sm); color: var(--color-text-primary); font-size: 0.9rem; outline: none; margin-bottom: 14px; cursor: pointer; }
    .assign-select:focus { border-color: var(--color-primary); }
    .modal-actions { display: flex; gap: 10px; }
    .modal-btn { flex: 1; padding: 11px; border-radius: var(--radius-sm); font-weight: 700; font-size: 0.9rem; cursor: pointer; transition: all 0.2s; border: 1px solid; }
    .modal-btn.confirm { background: var(--color-primary); color: white; border-color: transparent; box-shadow: 0 4px 10px rgba(37,99,235,0.3); }
    .modal-btn.cancel { background: var(--color-card); color: var(--color-text-primary); border-color: var(--border-medium); }
    .modal-btn:hover { opacity: 0.9; }

    /* ===== TOAST ===== */
    .toast { position: fixed; bottom: 24px; right: 24px; background: var(--color-card); border: 1px solid var(--border-medium); border-radius: 12px; padding: 14px 18px; display: flex; align-items: center; gap: 12px; z-index: 9999; box-shadow: var(--shadow-lg); transform: translateX(120%); transition: transform 0.4s cubic-bezier(0.175,0.885,0.32,1.275); max-width: 340px; }
    .toast.show { transform: translateX(0); }
    .toast-icon { font-size: 22px; }
    .toast-msg { font-weight: 600; font-size: 0.88rem; color: var(--color-text-primary); }
    .toast-sub { font-size: 0.75rem; color: var(--color-text-secondary); margin-top: 2px; }

    /* ===== NOTIFICATION PANEL ===== */
    .notif-panel { position: absolute; top: 48px; right: 0; width: 320px; background: var(--color-card); border: 1px solid var(--border-medium); border-radius: 14px; box-shadow: var(--shadow-lg); z-index: 200; display: none; overflow: hidden; }
    .notif-panel.open { display: block; }
    .notif-panel-header { padding: 14px 16px; border-bottom: 1px solid var(--border-light); display: flex; align-items: center; justify-content: space-between; }
    .notif-panel-title { font-weight: 700; font-size: 0.88rem; color: var(--color-text-primary); }
    .notif-mark-read { font-size: 0.75rem; color: var(--color-primary); cursor: pointer; font-weight: 600; }
    .notif-list { max-height: 320px; overflow-y: auto; }
    .notif-item { padding: 12px 16px; border-bottom: 1px solid var(--border-light); display: flex; gap: 10px; cursor: pointer; transition: background 0.15s; }
    .notif-item:hover { background: var(--color-secondary); }
    .notif-item.unread { background: var(--color-secondary); }
    .notif-dot-unread { width: 7px; height: 7px; border-radius: 50%; background: var(--color-primary); flex-shrink: 0; margin-top: 5px; }
    .notif-content { flex: 1; }
    .notif-text { font-size: 0.82rem; color: var(--color-text-secondary); line-height: 1.4; }
    .notif-text strong { color: var(--color-text-primary); }
    .notif-time { font-size: 0.7rem; color: var(--color-text-secondary); margin-top: 3px; }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 1200px) { .kpi-grid { grid-template-columns: repeat(2,1fr); } .charts-row { grid-template-columns: 1fr; } .profiles-grid { grid-template-columns: repeat(2,1fr); } .before-after-grid { grid-template-columns: 1fr; } .perf-grid { grid-template-columns: 1fr; } }
    @media (max-width: 900px) { .sidebar { transform: translateX(-100%); } .sidebar.open { transform: translateX(0); } .main { margin-left: 0; } .mobile-menu-btn { display: flex; } }
    @media (max-width: 600px) { .kpi-grid { grid-template-columns: 1fr 1fr; } .profiles-grid { grid-template-columns: 1fr; } }

    /* ===== ROLE VISIBILITY ===== */
    [data-role="nagar-sevak"] .role-hide-ns { display: none !important; }
    [data-role="ward-officer"] .role-hide-wo { display: none !important; }
    /* by default everything visible, we'll hide based on role via js */
  </style>
</head>
<body>

<!-- LOGIN SCREEN (light) -->
<div class="login-screen" id="loginScreen">
  <div class="login-bg"></div>
  <div class="login-grid-lines"></div>
  <div class="login-card">
    <div class="login-logo">
      <div class="login-emblem">üèõÔ∏è</div>
      <div class="login-brand">
        <div class="login-brand-name">NAGAR-SEVA</div>
        <div class="login-brand-sub" data-i18n="loginSub">Admin Portal ¬∑ Borivali Municipal</div>
      </div>
    </div>
    <div class="login-title" data-i18n="loginTitle">Secure Login</div>
    <div class="login-subtitle" data-i18n="loginSubtitle">Access restricted to authorised BMC officials only</div>
    <div style="margin-bottom:16px;">
      <div style="font-size:0.75rem;font-weight:700;color:var(--color-text-secondary);letter-spacing:0.08em;text-transform:uppercase;margin-bottom:8px;" data-i18n="loginAs">Login As</div>
      <div class="login-role">
        <div class="role-btn active" onclick="setRole(this,'Ward Officer')">üè¢ <span data-i18n="roleWardOfficer">Ward Officer</span></div>
        <div class="role-btn" onclick="setRole(this,'Nagar Sevak')">üëÆ <span data-i18n="roleNagarSevak">Nagar Sevak</span></div>
        <div class="role-btn" onclick="setRole(this,'Super Admin')">üîë <span data-i18n="roleSuperAdmin">Super Admin</span></div>
      </div>
    </div>
    <div class="login-field">
      <label class="login-label" data-i18n="employeeId">Employee ID</label>
      <input class="login-input" type="text" placeholder="BMC-2025-XXXXX" id="loginId"/>
    </div>
    <div class="login-field">
      <label class="login-label" data-i18n="password">Password</label>
      <input class="login-input" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" id="loginPw"/>
    </div>
    <button class="login-btn" onclick="doLogin()">üîê <span data-i18n="loginBtn">Login to Dashboard</span></button>
    <div class="login-hint"><span data-i18n="demoHint">Demo: Press login with any input ¬∑ </span><span onclick="doLogin()">Quick Demo ‚Üí</span></div>
  </div>
</div>

<!-- SIDEBAR -->
<aside class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <div class="sidebar-logo">
      <div class="sidebar-emblem">üèõÔ∏è</div>
      <div>
        <div class="sidebar-brand">NAGAR-SEVA</div>
        <div class="sidebar-brand-sub" data-i18n="adminSub">Admin ¬∑ Borivali</div>
      </div>
    </div>
    <div class="admin-profile">
      <div class="admin-avatar" id="adminAvatar">SP</div>
      <div>
        <div class="admin-name" id="adminName">Suresh Patil</div>
        <div class="admin-role" id="adminRole">Ward Officer ‚Äì R-North</div>
      </div>
      <div class="online-dot"></div>
    </div>
  </div>
  <nav class="sidebar-nav">
    <div class="nav-section-label" data-i18n="navMain">Main</div>
    <div class="nav-item active" onclick="switchPanel('dashboard',this)"><span class="nav-icon">üìä</span> <span data-i18n="navDashboard">Dashboard</span> <span class="nav-badge green" data-i18n="live">Live</span></div>
    <div class="nav-item" onclick="switchPanel('complaints',this)"><span class="nav-icon">üìã</span> <span data-i18n="navComplaints">Complaints</span> <span class="nav-badge">12</span></div>
    <div class="nav-item" onclick="switchPanel('map',this)"><span class="nav-icon">üó∫Ô∏è</span> <span data-i18n="navMap">Live Map</span></div>
    <div class="nav-section-label" data-i18n="navManagement">Management</div>
    <div class="nav-item" onclick="switchPanel('profiles',this)"><span class="nav-icon">üëÆ</span> <span data-i18n="navSevaks">Nagar Sevaks</span></div>
    <div class="nav-item" onclick="switchPanel('baslider',this)"><span class="nav-icon">üñºÔ∏è</span> <span data-i18n="navBeforeAfter">Before & After</span></div>
    <div class="nav-item" onclick="switchPanel('performance',this)"><span class="nav-icon">üìà</span> <span data-i18n="navPerformance">Performance</span></div>
    <div class="nav-section-label" data-i18n="navSystem">System</div>
    <div class="nav-item" onclick="switchPanel('settings',this)"><span class="nav-icon">‚öôÔ∏è</span> <span data-i18n="navSettings">Settings</span></div>
    <a href="../Akatsuki/nagar-seva-part1.html" target="_blank" rel="noopener noreferrer" class="nav-item" data-i18n="navCitizenPortal">
  üåê <span>Citizen Portal</span> ‚Üó
</a> </nav>
  <div class="sidebar-footer">
    <button class="logout-btn" onclick="doLogout()">üö™ <span data-i18n="logout">Logout</span></button>
  </div>
</aside>

<!-- MAIN CONTENT -->
<div class="main" id="mainContent" style="display:none;">

  <!-- TOPBAR -->
  <div class="topbar">
    <div class="topbar-left">
      <button class="mobile-menu-btn" onclick="document.getElementById('sidebar').classList.toggle('open')">‚ò∞</button>
      <div>
        <div class="page-title" id="pageTitle" data-i18n="dashboardTitle">Dashboard Overview</div>
        <div class="breadcrumb">NAGAR-SEVA ‚Ä∫ <span id="pageBreadcrumb" data-i18n="dashboardBreadcrumb">Dashboard</span></div>
      </div>
    </div>
    <div class="topbar-right">
      <!-- Language Switcher -->
      <select class="lang-select" onchange="changeLanguage(this.value)">
        <option value="en">English</option>
        <option value="mr">‡§Æ‡§∞‡§æ‡§†‡•Ä</option>
        <option value="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
      </select>
      <div class="search-box"><span>üîç</span><input type="text" placeholder="Search complaints..." id="globalSearchInput" oninput="searchTable(this.value)"/></div>
      <div class="tb-btn" style="position:relative;" onclick="toggleNotif()">üîî<div class="tb-notif-dot"></div>
        <div class="notif-panel" id="notifPanel">
          <div class="notif-panel-header"><div class="notif-panel-title" data-i18n="notifications">Notifications</div><div class="notif-mark-read" onclick="markAllRead(event)" data-i18n="markAllRead">Mark all read</div></div>
          <div class="notif-list">
            <div class="notif-item unread"><div class="notif-dot-unread"></div><div class="notif-content"><div class="notif-text"><strong>New Emergency:</strong> Water pipe burst near Borivali Station</div><div class="notif-time">2 mins ago</div></div></div>
            <div class="notif-item unread"><div class="notif-dot-unread"></div><div class="notif-content"><div class="notif-text"><strong>Assigned to you:</strong> NS-2025-00891 ‚Äì Pothole on SV Road</div><div class="notif-time">15 mins ago</div></div></div>
            <div class="notif-item"><div style="width:7px;flex-shrink:0;"></div><div class="notif-content"><div class="notif-text">NS-2025-00847 marked as <strong>Resolved</strong> by Rakesh More</div><div class="notif-time">1 hr ago</div></div></div>
            <div class="notif-item"><div style="width:7px;flex-shrink:0;"></div><div class="notif-content"><div class="notif-text">Monthly performance report for <strong>January 2025</strong> is ready</div><div class="notif-time">3 hrs ago</div></div></div>
            <div class="notif-item"><div style="width:7px;flex-shrink:0;"></div><div class="notif-content"><div class="notif-text">5 complaints pending for more than <strong>7 days</strong></div><div class="notif-time">Yesterday</div></div></div>
          </div>
        </div>
      </div>
      <div class="tb-btn">üåô</div>
    </div>
  </div>

  <!-- CONTENT PANELS (identical structure, but role-based visibility will be applied via JS) -->
  <div class="content" id="contentArea">
    <!-- PANEL: DASHBOARD -->
    <div class="panel active" id="panel-dashboard">
      <div class="kpi-grid">
        <div class="kpi-card">
          <div class="kpi-top"><div class="kpi-icon">üìã</div><div class="kpi-change up">‚Üë 8%</div></div>
          <div class="kpi-number" id="kpi1">0</div>
          <div class="kpi-label" data-i18n="totalComplaints">Total Complaints (This Month)</div>
          <div class="kpi-sub">‚Üë 14 more than last month</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-top"><div class="kpi-icon">‚úÖ</div><div class="kpi-change up">‚Üë 12%</div></div>
          <div class="kpi-number" id="kpi2">0</div>
          <div class="kpi-label" data-i18n="resolvedComplaints">Resolved Complaints</div>
          <div class="kpi-sub">87% resolution rate</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-top"><div class="kpi-icon">‚è≥</div><div class="kpi-change down">‚Üë 3</div></div>
          <div class="kpi-number" id="kpi3">0</div>
          <div class="kpi-label" data-i18n="pendingComplaints">Pending / In Progress</div>
          <div class="kpi-sub">2 marked emergency</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-top"><div class="kpi-icon">‚ö°</div><div class="kpi-change up">‚Üì 0.4d</div></div>
          <div class="kpi-number" id="kpi4">0</div>
          <div class="kpi-label" data-i18n="avgResolution">Avg. Resolution (days)</div>
          <div class="kpi-sub">Target: &lt;3 days</div>
        </div>
      </div>
      <div class="charts-row">
        <div class="chart-card">
          <div class="card-header">
            <div><div class="card-title" data-i18n="monthlyTrends">Monthly Complaint Trends</div><div class="card-subtitle" data-i18n="reportedVsResolved">Reported vs Resolved ¬∑ Jan 2025</div></div>
            <div class="card-actions">
              <div class="chip active" onclick="setChip(this)" data-i18n="thisMonth">This Month</div>
              <div class="chip" onclick="setChip(this)" data-i18n="sixMonths">6 Months</div>
              <div class="chip" onclick="setChip(this)" data-i18n="year">Year</div>
            </div>
          </div>
          <div class="bar-chart" id="barChart"></div>
          <div style="display:flex;gap:16px;margin-top:12px;">
            <div style="display:flex;align-items:center;gap:6px;font-size:0.75rem;color:var(--color-text-secondary);"><div style="width:12px;height:12px;border-radius:2px;background:var(--color-primary);"></div><span data-i18n="reported">Reported</span></div>
            <div style="display:flex;align-items:center;gap:6px;font-size:0.75rem;color:var(--color-text-secondary);"><div style="width:12px;height:12px;border-radius:2px;background:var(--color-secondary);"></div><span data-i18n="resolved">Resolved</span></div>
          </div>
        </div>
        <div class="chart-card">
          <div class="card-header"><div><div class="card-title" data-i18n="byCategory">By Category</div><div class="card-subtitle" data-i18n="currentMonth">Current month</div></div></div>
          <div class="donut-wrap">
            <svg viewBox="0 0 120 120" width="140" height="140">
              <circle cx="60" cy="60" r="45" fill="none" stroke="var(--border-light)" stroke-width="18"/>
              <circle cx="60" cy="60" r="45" fill="none" stroke="var(--color-primary)" stroke-width="18" stroke-dasharray="85 197" stroke-dashoffset="-0" transform="rotate(-90 60 60)" stroke-linecap="round"/>
              <circle cx="60" cy="60" r="45" fill="none" stroke="var(--color-secondary)" stroke-width="18" stroke-dasharray="52 197" stroke-dashoffset="-85" transform="rotate(-90 60 60)" stroke-linecap="round"/>
              <circle cx="60" cy="60" r="45" fill="none" stroke="var(--color-success)" stroke-width="18" stroke-dasharray="35 197" stroke-dashoffset="-137" transform="rotate(-90 60 60)" stroke-linecap="round"/>
              <circle cx="60" cy="60" r="45" fill="none" stroke="var(--color-warning)" stroke-width="18" stroke-dasharray="25 197" stroke-dashoffset="-172" transform="rotate(-90 60 60)" stroke-linecap="round"/>
            </svg>
            <div class="donut-center"><div class="donut-center-num">197</div><div class="donut-center-label" data-i18n="total">Total</div></div>
          </div>
          <div class="donut-legend">
            <div class="legend-item"><div class="legend-dot" style="background:var(--color-primary);"></div><span class="legend-name" data-i18n="roads">Roads</span><span class="legend-pct">43%</span></div>
            <div class="legend-item"><div class="legend-dot" style="background:var(--color-secondary);"></div><span class="legend-name" data-i18n="water">Water</span><span class="legend-pct">26%</span></div>
            <div class="legend-item"><div class="legend-dot" style="background:var(--color-success);"></div><span class="legend-name" data-i18n="garbage">Garbage</span><span class="legend-pct">18%</span></div>
            <div class="legend-item"><div class="legend-dot" style="background:var(--color-warning);"></div><span class="legend-name" data-i18n="others">Others</span><span class="legend-pct">13%</span></div>
          </div>
        </div>
      </div>
      <div class="chart-card" style="margin-bottom:24px;">
        <div class="card-header">
          <div><div class="card-title" data-i18n="heatmapTitle">üå°Ô∏è Area-wise Complaint Heatmap ‚Äì Borivali</div><div class="card-subtitle" data-i18n="heatmapSub">Darker = Higher complaint density</div></div>
        </div>
        <div class="heatmap-grid-container" id="heatmapContainer"></div>
      </div>
      <div class="table-card">
        <div class="table-toolbar">
          <div class="card-title" data-i18n="recentHighPriority">üö® Recent High-Priority Complaints</div>
          <div style="margin-left:auto;" class="chip" onclick="switchPanel('complaints',document.querySelector('[onclick*=complaints]'))" data-i18n="viewAll">View All ‚Üí</div>
        </div>
        <table id="recentTable"></table>
      </div>
    </div>

    <!-- PANEL: COMPLAINTS -->
    <div class="panel" id="panel-complaints">
      <div class="table-section">
        <div class="table-card">
          <div class="table-toolbar">
            <div class="filter-tabs">
              <div class="filter-tab active" onclick="filterComplaints('all',this)">All (47)</div>
              <div class="filter-tab" onclick="filterComplaints('reported',this)">New (12)</div>
              <div class="filter-tab" onclick="filterComplaints('assigned',this)">Assigned (18)</div>
              <div class="filter-tab" onclick="filterComplaints('progress',this)">In Progress (9)</div>
              <div class="filter-tab" onclick="filterComplaints('resolved',this)">Resolved (8)</div>
            </div>
            <div class="tb-search">üîç<input type="text" placeholder="Search by ID, location..." oninput="searchTable(this.value)"/></div>
          </div>
          <table id="complaintTable"></table>
        </div>
      </div>
    </div>

    <!-- Other panels (map, profiles, baslider, performance, settings) remain same structure but we'll apply role visibility to action buttons etc. -->
    <!-- For brevity, I'm keeping the original HTML for those panels but they will be updated with new color classes. Since the content is long, I'll include the rest but ensure all use the new color variables. -->

    <!-- MAP PANEL (shortened for space, but will use new colors) -->
    <!-- ‚îÄ‚îÄ‚îÄ PANEL: MAP ‚îÄ‚îÄ‚îÄ -->
<div class="panel" id="panel-map">
  <div class="chart-card">
    <div class="card-header">
      <div>
        <div class="card-title" data-i18n="liveMap">üó∫Ô∏è Live Complaint Map ‚Äì Borivali</div>
        <div class="card-subtitle" data-i18n="mapSub">Real-time pins ¬∑ Click to view details</div>
      </div>
    </div>
    <div id="adminMap" style="height: 500px; border-radius: 12px; overflow: hidden;"></div>
    <!-- Legend stays the same, we'll keep it below the map -->
    <div style="margin-top: 16px; display: flex; gap: 16px; flex-wrap: wrap;" class="map-legend">
      <div class="legend-item"><span class="legend-color" style="background:#2563EB;"></span> <span data-i18n="water">Water</span></div>
      <div class="legend-item"><span class="legend-color" style="background:#F59E0B;"></span> <span data-i18n="electricity">Electricity</span></div>
      <div class="legend-item"><span class="legend-color" style="background:#EF4444;"></span> <span data-i18n="roads">Roads</span></div>
      <div class="legend-item"><span class="legend-color" style="background:#22C55E;"></span> <span data-i18n="garbage">Garbage</span></div>
      <div class="legend-item"><span class="legend-color" style="background:#475569;"></span> <span data-i18n="other">Other</span></div>
    </div>
  </div>
</div>
    <!-- PROFILES PANEL (will use new colors, already updated in CSS) -->
    <div class="panel" id="panel-profiles">
      <div class="profiles-grid" id="profilesGrid"></div>
    </div>

    <!-- BEFORE/AFTER PANEL -->
    <div class="panel" id="panel-baslider">
      <div class="before-after-grid" id="baGrid"></div>
    </div>

    <!-- PERFORMANCE PANEL -->
    <div class="panel" id="panel-performance">
      <div class="perf-grid">
        <div class="chart-card">
          <div class="card-header"><div><div class="card-title" data-i18n="topPerforming">üèÜ Top Performing Nagar Sevaks</div><div class="card-subtitle" data-i18n="topPerformingSub">Based on resolution rate ¬∑ January 2025</div></div></div>
          <div class="officer-list" id="officerList"></div>
        </div>
        <div style="display:flex;flex-direction:column;gap:16px;">
          <div class="chart-card">
            <div class="card-header"><div><div class="card-title" data-i18n="monthSummary">üìä This Month Summary</div></div></div>
            <div style="display:flex;flex-direction:column;gap:12px;" id="perfSummary"></div>
          </div>
          <div class="chart-card">
            <div class="card-header"><div><div class="card-title" data-i18n="resolutionByWard">üéØ Resolution by Ward</div></div></div>
            <div id="wardPerf" style="display:flex;flex-direction:column;gap:10px;"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- SETTINGS PANEL (short) -->
    <div class="panel" id="panel-settings">
      <div class="chart-card" style="max-width:600px;">
        <div class="card-header"><div><div class="card-title" data-i18n="settingsTitle">‚öôÔ∏è Admin Settings</div><div class="card-subtitle" data-i18n="settingsSub">System configuration for NAGAR-SEVA</div></div></div>
        <div style="display:flex;flex-direction:column;gap:20px;">
          <div class="setting-item" style="display:flex;align-items:center;justify-content:space-between;padding:14px;background:var(--color-card);border-radius:var(--radius-sm);border:1px solid var(--border-light);">
            <div><div style="font-weight:600;font-size:0.9rem;color:var(--color-text-primary);" data-i18n="autoAssign">Auto-Assign Complaints</div><div style="font-size:0.78rem;color:var(--color-text-secondary);margin-top:2px;" data-i18n="autoAssignSub">Automatically route to ward Nagar Sevak</div></div>
            <div style="width:44px;height:24px;border-radius:12px;background:var(--color-primary);position:relative;cursor:pointer;"><div style="position:absolute;width:18px;height:18px;border-radius:50%;background:white;top:3px;right:3px;"></div></div>
          </div>
          <!-- other settings items similarly updated -->
        </div>
      </div>
    </div>
  </div><!-- /content -->
</div><!-- /main -->

<!-- MODAL -->
<div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
  <div class="modal" id="modal">
    <div class="modal-header">
      <div class="modal-title" id="modalTitle" data-i18n="complaintDetails">Complaint Details</div>
      <div class="modal-close" onclick="closeModal()">‚úï</div>
    </div>
    <div class="modal-body" id="modalBody"></div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast">
  <div class="toast-icon" id="toastIcon">‚úÖ</div>
  <div><div class="toast-msg" id="toastMsg">Success</div><div class="toast-sub" id="toastSub"></div></div>
</div>

<style>@keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.5;transform:scale(1.3)}}</style>

<script>
// ==================== DATA & GLOBAL VARIABLES ====================
const complaints = [
  { id:'NS-2025-00892', title:'Water pipe burst ‚Äì Link Road signal', cat:'üíß Water', catKey:'water', loc:'Link Road, Borivali W', ward:'R-North', priority:'high', status:'reported', citizen:'Rahul S.', date:'14 Feb 2025', emergency:true },
  { id:'NS-2025-00891', title:'Deep pothole on SV Road near flyover', cat:'üõ£Ô∏è Roads', catKey:'roads', loc:'SV Road, Borivali W', ward:'R-North', priority:'high', status:'assigned', citizen:'Priya P.', date:'13 Feb 2025', emergency:false },
  { id:'NS-2025-00890', title:'Garbage not collected for 5 days', cat:'üóëÔ∏è Garbage', catKey:'garbage', loc:'Shimpoli Road, Borivali W', ward:'R-Central', priority:'medium', status:'progress', citizen:'Sanjay K.', date:'12 Feb 2025', emergency:false },
  { id:'NS-2025-00889', title:'Streetlight out ‚Äì entire sector dark', cat:'üí° Streetlight', catKey:'streetlight', loc:'IC Colony, Borivali W', ward:'R-North', priority:'medium', status:'assigned', citizen:'Meera J.', date:'11 Feb 2025', emergency:false },
  { id:'NS-2025-00888', title:'Flooding near Borivali station east', cat:'üåä Drainage', catKey:'drainage', loc:'Borivali East Station', ward:'R-Central', priority:'high', status:'progress', citizen:'Vikram N.', date:'10 Feb 2025', emergency:true },
  { id:'NS-2025-00887', title:'Electricity wire loose ‚Äì danger to public', cat:'‚ö° Electricity', catKey:'electricity', loc:'Eksar Road, Borivali W', ward:'R-North', priority:'high', status:'reported', citizen:'Anita D.', date:'10 Feb 2025', emergency:true },
  { id:'NS-2025-00886', title:'Broken footpath tiles ‚Äì elderly hazard', cat:'üõ£Ô∏è Roads', catKey:'roads', loc:'Station Road, Borivali E', ward:'R-Central', priority:'low', status:'resolved', citizen:'Suresh M.', date:'08 Feb 2025', emergency:false },
  { id:'NS-2025-00885', title:'Overflowing drain ‚Äì foul smell', cat:'üåä Drainage', catKey:'drainage', loc:'Mandapeshwar, Borivali W', ward:'R-North', priority:'medium', status:'resolved', citizen:'Kavita R.', date:'07 Feb 2025', emergency:false },
  { id:'NS-2025-00884', title:'Broken park bench ‚Äì Rajiv Gandhi Udyan', cat:'üö® Safety', catKey:'safety', loc:'Rajiv Gandhi Udyan, Bori W', ward:'R-North', priority:'low', status:'resolved', citizen:'Nikhil B.', date:'06 Feb 2025', emergency:false },
  { id:'NS-2025-00883', title:'No water supply for 2 days ‚Äì sector 4', cat:'üíß Water', catKey:'water', loc:'Sector 4, Borivali E', ward:'R-Central', priority:'high', status:'assigned', citizen:'Deepa S.', date:'05 Feb 2025', emergency:false },
];

const nagarsevaks = [
  { name:'Suresh Patil', desig:'Senior Nagar Sevak', ward:'R-North (Borivali West)', exp:'12 yrs', cases:482, resolved:441, rate:91, contact:'9820XXXXXX', emoji:'üëÆ', color:'var(--color-primary)', active:true },
  { name:'Rakesh More', desig:'Nagar Sevak', ward:'R-Central (Borivali East)', exp:'8 yrs', cases:318, resolved:279, rate:87, contact:'9821XXXXXX', emoji:'üë®‚Äçüíº', color:'var(--color-secondary)', active:true },
  { name:'Priya Kamble', desig:'Junior Nagar Sevak', ward:'R-South (Dahisar)', exp:'4 yrs', cases:196, resolved:162, rate:82, contact:'9822XXXXXX', emoji:'üë©‚Äçüíº', color:'var(--color-warning)', active:false },
  { name:'Anil Shinde', desig:'Senior Nagar Sevak', ward:'Ward S (Kandivali)', exp:'15 yrs', cases:621, resolved:583, rate:93, contact:'9823XXXXXX', emoji:'üë¥', color:'var(--color-success)', active:true },
  { name:'Sunita Rane', desig:'Nagar Sevak', ward:'R-North (Borivali West)', exp:'6 yrs', cases:254, resolved:214, rate:84, contact:'9824XXXXXX', emoji:'üë©', color:'var(--color-critical)', active:true },
  { name:'Manoj Jadhav', desig:'Nagar Sevak', ward:'R-Central (Borivali East)', exp:'9 yrs', cases:341, resolved:300, rate:88, contact:'9825XXXXXX', emoji:'üßë‚Äçüíº', color:'var(--color-warning)', active:false },
];

const baData = [
  { title:'Pothole ‚Äì SV Road', sub:'Ward R-North ¬∑ Fixed in 2 days', before:'üï≥Ô∏è', after:'üõ£Ô∏è', officer:'Suresh Patil', date:'10 Feb 2025' },
  { title:'Garbage Pile ‚Äì Shimpoli', sub:'Ward R-Central ¬∑ Cleared next morning', before:'üóëÔ∏è', after:'‚ú®', officer:'Rakesh More', date:'08 Feb 2025' },
  { title:'Broken Streetlight ‚Äì IC Colony', sub:'Ward R-North ¬∑ Replaced in 1 day', before:'üåë', after:'üí°', officer:'Sunita Rane', date:'06 Feb 2025' },
  { title:'Drainage Overflow ‚Äì Mandapeshwar', sub:'Ward R-North ¬∑ Cleared within 3 hrs', before:'üíß', after:'üèûÔ∏è', officer:'Suresh Patil', date:'04 Feb 2025' },
];

const catColors = { 
  water:'var(--color-primary)', 
  roads:'var(--color-critical)', 
  garbage:'var(--color-success)', 
  drainage:'var(--color-warning)', 
  electricity:'var(--color-warning)', 
  streetlight:'#F59E0B', 
  safety:'var(--color-critical)', 
  other:'var(--color-secondary)' 
};

let currentRole = 'Ward Officer'; // default

// ==================== LOGIN & ROLE ====================
function setRole(el, role) {
  currentRole = role;
  document.querySelectorAll('.role-btn').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
}

function doLogin() {
  const loginScreen = document.getElementById('loginScreen');
  loginScreen.style.opacity = '0';
  loginScreen.style.transition = 'opacity 0.5s';
  setTimeout(() => {
    loginScreen.style.display = 'none';
    const main = document.getElementById('mainContent');
    main.style.display = 'flex';
    main.style.opacity = '0';
    main.style.transition = 'opacity 0.4s';
    setTimeout(() => main.style.opacity = '1', 50);

    // Set role-based UI
    document.body.setAttribute('data-role', currentRole.toLowerCase().replace(' ', '-'));
    // Update admin profile based on role
    updateAdminProfile();
    // Apply permissions (hide elements)
    applyPermissions();

    initDashboard();
    showToast('‚úÖ', 'Welcome back!', currentRole + ' Dashboard loaded', 'var(--color-success)');
  }, 500);
}

function updateAdminProfile() {
  const nameMap = {
    'Ward Officer': 'Suresh Patil',
    'Nagar Sevak': 'Rakesh More',
    'Super Admin': 'Admin User'
  };
  const roleMap = {
    'Ward Officer': 'Ward Officer ‚Äì R-North',
    'Nagar Sevak': 'Nagar Sevak ‚Äì R-Central',
    'Super Admin': 'Super Administrator'
  };
  document.getElementById('adminName').innerText = nameMap[currentRole] || 'Admin';
  document.getElementById('adminRole').innerText = roleMap[currentRole] || 'Role';
  document.getElementById('adminAvatar').innerText = (nameMap[currentRole] || 'A').split(' ').map(w=>w[0]).join('');
}

function applyPermissions() {
  // Hide elements based on role
  // For Nagar Sevak: hide assign buttons, certain management tabs
  if (currentRole === 'Nagar Sevak') {
    // Add class to body for CSS hiding
    document.body.classList.add('role-nagar-sevak');
    // Alternatively, use data-role already set
  } else {
    document.body.classList.remove('role-nagar-sevak');
  }
  // More fine-grained: we can hide .assign buttons for nagar sevak via CSS
}

function doLogout() {
  document.getElementById('mainContent').style.display = 'none';
  const ls = document.getElementById('loginScreen');
  ls.style.opacity = '1'; ls.style.display = 'flex';
  document.body.removeAttribute('data-role');
}

// ==================== LANGUAGE ====================
const translations = {
  en: {
    loginSub: 'Admin Portal ¬∑ Borivali Municipal',
    loginTitle: 'Secure Login',
    loginSubtitle: 'Access restricted to authorised BMC officials only',
    loginAs: 'Login As',
    roleWardOfficer: 'Ward Officer',
    roleNagarSevak: 'Nagar Sevak',
    roleSuperAdmin: 'Super Admin',
    employeeId: 'Employee ID',
    password: 'Password',
    loginBtn: 'Login to Dashboard',
    demoHint: 'Demo: Press login with any input ¬∑ ',
    navMain: 'Main',
    navDashboard: 'Dashboard',
    live: 'Live',
    navComplaints: 'Complaints',
    navMap: 'Live Map',
    navManagement: 'Management',
    navSevaks: 'Nagar Sevaks',
    navBeforeAfter: 'Before & After',
    navPerformance: 'Performance',
    navSystem: 'System',
    navSettings: 'Settings',
    navCitizenPortal: 'Citizen Portal',
    logout: 'Logout',
    dashboardTitle: 'Dashboard Overview',
    dashboardBreadcrumb: 'Dashboard',
    notifications: 'Notifications',
    markAllRead: 'Mark all read',
    totalComplaints: 'Total Complaints (This Month)',
    resolvedComplaints: 'Resolved Complaints',
    pendingComplaints: 'Pending / In Progress',
    avgResolution: 'Avg. Resolution (days)',
    monthlyTrends: 'Monthly Complaint Trends',
    reportedVsResolved: 'Reported vs Resolved ¬∑ Jan 2025',
    thisMonth: 'This Month',
    sixMonths: '6 Months',
    year: 'Year',
    reported: 'Reported',
    resolved: 'Resolved',
    byCategory: 'By Category',
    currentMonth: 'Current month',
    total: 'Total',
    roads: 'Roads',
    water: 'Water',
    garbage: 'Garbage',
    others: 'Others',
    heatmapTitle: 'üå°Ô∏è Area-wise Complaint Heatmap ‚Äì Borivali',
    heatmapSub: 'Darker = Higher complaint density',
    recentHighPriority: 'üö® Recent High-Priority Complaints',
    viewAll: 'View All ‚Üí',
    liveMap: 'üó∫Ô∏è Live Complaint Map ‚Äì Borivali',
    mapSub: 'Real-time pins ¬∑ Click to view details',
    legend: 'LEGEND',
    streetlight: 'Streetlight',
    activeComplaints: '47 Active Complaints ¬∑ Live',
    topPerforming: 'üèÜ Top Performing Nagar Sevaks',
    topPerformingSub: 'Based on resolution rate ¬∑ January 2025',
    monthSummary: 'üìä This Month Summary',
    resolutionByWard: 'üéØ Resolution by Ward',
    settingsTitle: '‚öôÔ∏è Admin Settings',
    settingsSub: 'System configuration for NAGAR-SEVA',
    autoAssign: 'Auto-Assign Complaints',
    autoAssignSub: 'Automatically route to ward Nagar Sevak',
    complaintDetails: 'Complaint Details'
  },
  mr: {
    loginSub: '‡§™‡•ç‡§∞‡§∂‡§æ‡§∏‡§® ‡§™‡•ã‡§∞‡•ç‡§ü‡§≤ ¬∑ ‡§¨‡•ã‡§∞‡§ø‡§µ‡§≤‡•Ä ‡§Æ‡§π‡§æ‡§®‡§ó‡§∞‡§™‡§æ‡§≤‡§ø‡§ï‡§æ',
    loginTitle: '‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§≤‡•â‡§ó‡§ø‡§®',
    loginSubtitle: '‡§ï‡•á‡§µ‡§≤ ‡§Ö‡§ß‡§ø‡§ï‡•É‡§§ ‡§¨‡•Ä‡§è‡§Æ‡§∏‡•Ä ‡§Ö‡§ß‡§ø‡§ï‡§æ‡§±‡•ç‡§Ø‡§æ‡§Ç‡§∏‡§æ‡§†‡•Ä ‡§™‡•ç‡§∞‡§µ‡•á‡§∂',
    loginAs: '‡§™‡•ç‡§∞‡§µ‡•á‡§∂ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞',
    roleWardOfficer: '‡§µ‡§æ‡§∞‡•ç‡§° ‡§Ö‡§ß‡§ø‡§ï‡§æ‡§∞‡•Ä',
    roleNagarSevak: '‡§®‡§ó‡§∞‡§∏‡•á‡§µ‡§ï',
    roleSuperAdmin: '‡§∏‡•Å‡§™‡§∞ ‡§Ö‡•Ö‡§°‡§Æ‡§ø‡§®',
    employeeId: '‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä ‡§Ü‡§Ø‡§°‡•Ä',
    password: '‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°',
    loginBtn: '‡§°‡•Ö‡§∂‡§¨‡•ã‡§∞‡•ç‡§°‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§™‡•ç‡§∞‡§µ‡•á‡§∂ ‡§ï‡§∞‡§æ',
    demoHint: '‡§°‡•á‡§Æ‡•ã: ‡§ï‡•ã‡§£‡§§‡•ç‡§Ø‡§æ‡§π‡•Ä ‡§á‡§®‡§™‡•Å‡§ü‡§∏‡§π ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡§æ ¬∑ ',
    navDashboard: '‡§°‡•Ö‡§∂‡§¨‡•ã‡§∞‡•ç‡§°',
    live: '‡§•‡•á‡§ü',
    navComplaints: '‡§§‡§ï‡•ç‡§∞‡§æ‡§∞‡•Ä',
    navMap: '‡§•‡•á‡§ü ‡§®‡§ï‡§æ‡§∂‡§æ',
    navSevaks: '‡§®‡§ó‡§∞‡§∏‡•á‡§µ‡§ï',
    navBeforeAfter: '‡§Ü‡§ß‡•Ä ‡§Ü‡§£‡§ø ‡§®‡§Ç‡§§‡§∞',
    navPerformance: '‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ',
    navSettings: '‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§ú',
    navCitizenPortal: '‡§®‡§æ‡§ó‡§∞‡§ø‡§ï ‡§™‡•ã‡§∞‡•ç‡§ü‡§≤',
    logout: '‡§¨‡§æ‡§π‡•á‡§∞ ‡§™‡§°‡§æ',
    dashboardTitle: '‡§°‡•Ö‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‡§µ‡§ø‡§π‡§Ç‡§ó‡§æ‡§µ‡§≤‡•ã‡§ï‡§®',
    // ... (remaining keys similar, shorten for demo)
  },
  hi: {
    loginSub: '‡§™‡•ç‡§∞‡§∂‡§æ‡§∏‡§® ‡§™‡•ã‡§∞‡•ç‡§ü‡§≤ ¬∑ ‡§¨‡•ã‡§∞‡§ø‡§µ‡§≤‡•Ä ‡§®‡§ó‡§∞ ‡§®‡§ø‡§ó‡§Æ',
    loginTitle: '‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§≤‡•â‡§ó‡§ø‡§®',
    loginSubtitle: '‡§ï‡•á‡§µ‡§≤ ‡§Ö‡§ß‡§ø‡§ï‡•É‡§§ ‡§¨‡•Ä‡§è‡§Æ‡§∏‡•Ä ‡§Ö‡§ß‡§ø‡§ï‡§æ‡§∞‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§™‡§π‡•Å‡§Ç‡§ö',
    loginAs: '‡§≤‡•â‡§ó‡§ø‡§® ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞',
    roleWardOfficer: '‡§µ‡§æ‡§∞‡•ç‡§° ‡§Ö‡§ß‡§ø‡§ï‡§æ‡§∞‡•Ä',
    roleNagarSevak: '‡§®‡§ó‡§∞ ‡§∏‡•á‡§µ‡§ï',
    roleSuperAdmin: '‡§∏‡•Å‡§™‡§∞ ‡§è‡§°‡§Æ‡§ø‡§®',
    employeeId: '‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä ‡§Ü‡§à‡§°‡•Ä',
    password: '‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°',
    loginBtn: '‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‡§Æ‡•á‡§Ç ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç',
    demoHint: '‡§°‡•á‡§Æ‡•ã: ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§á‡§®‡§™‡•Å‡§ü ‡§ï‡•á ‡§∏‡§æ‡§• ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç ¬∑ ',
    navDashboard: '‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°',
    live: '‡§≤‡§æ‡§á‡§µ',
    navComplaints: '‡§∂‡§ø‡§ï‡§æ‡§Ø‡§§‡•á‡§Ç',
    navMap: '‡§≤‡§æ‡§á‡§µ ‡§Æ‡§æ‡§®‡§ö‡§ø‡§§‡•ç‡§∞',
    navSevaks: '‡§®‡§ó‡§∞ ‡§∏‡•á‡§µ‡§ï',
    navBeforeAfter: '‡§™‡§π‡§≤‡•á ‡§î‡§∞ ‡§¨‡§æ‡§¶',
    navPerformance: '‡§™‡•ç‡§∞‡§¶‡§∞‡•ç‡§∂‡§®',
    navSettings: '‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏',
    navCitizenPortal: '‡§®‡§æ‡§ó‡§∞‡§ø‡§ï ‡§™‡•ã‡§∞‡•ç‡§ü‡§≤',
    logout: '‡§≤‡•â‡§ó‡§Ü‡§â‡§ü',
    dashboardTitle: '‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‡§Ö‡§µ‡§≤‡•ã‡§ï‡§®',
    // ... remaining
  }
};

function changeLanguage(lang) {
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    if (translations[lang] && translations[lang][key]) {
      el.innerText = translations[lang][key];
    }
  });
}

// ==================== DASHBOARD INIT ====================
function initDashboard() {
  animateKPIs();
  buildBarChart();
  buildHeatmap();
  buildRecentTable();
  buildComplaintTable(complaints);
  buildProfiles();
  buildBASliders();
  buildPerformance();
//  buildMapPins();
}

function animateKPIs() {
  animateNum('kpi1', 197, '', 40);
  setTimeout(() => animateNum('kpi2', 172, '', 40), 100);
  setTimeout(() => animateNum('kpi3', 25, '', 40), 200);
  setTimeout(() => animateNum('kpi4', 3.2, '', 40, 1), 300);
}
function animateNum(id, target, suffix, delay, decimals = 0) {
  const el = document.getElementById(id);
  if (!el) return;
  let current = 0;
  const step = target / 50;
  const timer = setInterval(() => {
    current += step;
    if (current >= target) { current = target; clearInterval(timer); }
    el.textContent = decimals ? current.toFixed(decimals) : Math.floor(current);
  }, delay);
}

function buildBarChart() {
  const data = [
    { label:'Mon', reported:12, resolved:9 },
    { label:'Tue', reported:18, resolved:15 },
    { label:'Wed', reported:8, resolved:7 },
    { label:'Thu', reported:22, resolved:18 },
    { label:'Fri', reported:15, resolved:12 },
    { label:'Sat', reported:9, resolved:8 },
    { label:'Sun', reported:5, resolved:4 },
  ];
  const max = Math.max(...data.map(d => d.reported));
  const chart = document.getElementById('barChart');
  chart.innerHTML = data.map((d, i) => `
    <div class="bar-group">
      <div style="display:flex;gap:3px;align-items:flex-end;flex:1;width:100%;">
        <div class="bar" style="height:${(d.reported/max*140)}px;animation-delay:${i*0.08}s;" title="Reported: ${d.reported}"></div>
        <div class="bar blue" style="height:${(d.resolved/max*140)}px;animation-delay:${i*0.08+0.04}s;" title="Resolved: ${d.resolved}"></div>
      </div>
      <div class="bar-label">${d.label}</div>
    </div>
  `).join('');
}

const heatmapAreas = [
  'IC Colony','Shimpoli','Eksar','Mandapeshwar','Dahanukarwadi','Borivali Stn',
  'Link Road','SV Road','LT Road','Rajiv Nagar','Poisar','Gorai',
  'Chandavarkar','Kastur Park','Bharat Nagar','Aarey Colony','Magathane','Pahadi',
  'Borivali E','Borivali W','Kandivali','Dahisar','Malad','Akurli'
];
const heatLevels = [2,8,5,12,3,17,9,6,4,11,7,2,14,1,8,3,6,10,15,19,4,7,2,8];
function buildHeatmap() {
  const colors = [
    'var(--color-secondary)',
    'var(--color-primary)',
    '#2563EB',
    '#1D4ED8',
    '#1E3A8A'
  ];
  const maxH = Math.max(...heatLevels);
  const container = document.getElementById('heatmapContainer');
  container.innerHTML = ''; // clear
  const grid = document.createElement('div');
  grid.className = 'heatmap-areas';
  grid.innerHTML = heatmapAreas.map((a, i) => {
    const level = Math.floor((heatLevels[i] / maxH) * 4);
    return `<div class="hm-cell" style="background:${colors[level]}; color: white;" title="${a}: ${heatLevels[i]} complaints">${heatLevels[i]}</div>`;
  }).join('');
  const legend = document.createElement('div');
  legend.className = 'heatmap-legend';
  legend.innerHTML = ['Very Low','Low','Medium','High','Critical'].map((l, i) => 
    `<div class="hm-leg-item"><div class="hm-leg-color" style="background:${colors[i]};"></div>${l}</div>`
  ).join('');
  container.appendChild(grid);
  container.appendChild(legend);
}

function buildRecentTable() {
  const high = complaints.filter(c => c.priority === 'high').slice(0,4);
  renderTable('recentTable', high);
}
function buildComplaintTable(data) {
  renderTable('complaintTable', data);
}
function renderTable(tableId, data) {
  const table = document.getElementById(tableId);
  if (!table) return;
  table.innerHTML = `
    <thead><tr>
      <th data-i18n="id">ID</th><th data-i18n="title">Title</th><th data-i18n="category">Category</th><th data-i18n="location">Location</th><th data-i18n="priority">Priority</th><th data-i18n="status">Status</th><th data-i18n="date">Date</th><th data-i18n="actions">Actions</th>
    </tr></thead>
    <tbody>
      ${data.map(c => `
        <tr>
          <td><span class="complaint-id">${c.id}</span>${c.emergency ? ' <span style="font-size:0.7rem;background:var(--color-critical);color:white;padding:2px 5px;border-radius:3px;font-weight:700;">üö®</span>' : ''}</td>
          <td><div class="complaint-title">${c.title}</div></td>
          <td><span class="cat-tag" style="background:${catColors[c.catKey]}22;color:${catColors[c.catKey]};">${c.cat}</span></td>
          <td><div class="complaint-loc">üìç ${c.loc}</div></td>
          <td><span class="priority-dot ${c.priority}"></span> ${c.priority.charAt(0).toUpperCase()+c.priority.slice(1)}</td>
          <td><span class="status-pill ${c.status}">${getStatusLabel(c.status)}</span></td>
          <td style="color:var(--color-text-secondary);font-size:0.8rem;">${c.date}</td>
          <td style="display:flex;gap:5px;">
            <button class="action-btn view" onclick="viewComplaint(${complaints.indexOf(c)})">üëÅ <span data-i18n="view">View</span></button>
            <button class="action-btn assign ${currentRole === 'Nagar Sevak' ? 'role-hide-ns' : ''}" onclick="openAssign(${complaints.indexOf(c)})">üëÆ <span data-i18n="assign">Assign</span></button>
          </td>
        </tr>
      `).join('')}
    </tbody>
  `;
}

function getStatusLabel(s) {
  const m = { reported:'üîµ New', assigned:'üü° Assigned', progress:'üü£ In Progress', resolved:'üü¢ Resolved', emergency:'üî¥ Emergency' };
  return m[s] || s;
}

function filterComplaints(status, el) {
  document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  const filtered = status === 'all' ? complaints : complaints.filter(c => c.status === status);
  buildComplaintTable(filtered);
}

function searchTable(q) {
  const filtered = complaints.filter(c => 
    c.id.toLowerCase().includes(q.toLowerCase()) || 
    c.title.toLowerCase().includes(q.toLowerCase()) ||
    c.loc.toLowerCase().includes(q.toLowerCase())
  );
  buildComplaintTable(filtered);
}

function buildProfiles() {
  const grid = document.getElementById('profilesGrid');
  if (!grid) return;
  grid.innerHTML = nagarsevaks.map(s => `
    <div class="profile-card" style="--profile-color:${s.color};">
      <div class="profile-header">
        <div class="profile-avatar">${s.emoji}</div>
        <div class="profile-info">
          <div class="profile-name">${s.name}</div>
          <div class="profile-desig">${s.desig}</div>
          <div class="profile-ward">üìç ${s.ward}</div>
        </div>
        ${s.active ? '<div class="profile-status"></div>' : '<div style="position:absolute;top:20px;right:20px;width:10px;height:10px;border-radius:50%;background:var(--color-text-secondary);"></div>'}
      </div>
      <div class="profile-body">
        <div class="profile-stats">
          <div class="ps-item"><div class="ps-num">${s.cases}</div><div class="ps-label" data-i18n="totalCases">Total Cases</div></div>
          <div class="ps-item"><div class="ps-num">${s.resolved}</div><div class="ps-label" data-i18n="resolvedCases">Resolved</div></div>
          <div class="ps-item"><div class="ps-num">${s.rate}%</div><div class="ps-label" data-i18n="successRate">Success</div></div>
        </div>
        <div class="profile-progress">
          <div class="progress-label"><span data-i18n="resolutionRate">Resolution Rate</span><strong>${s.rate}%</strong></div>
          <div class="progress-bar-track"><div class="progress-bar-fill" style="width:${s.rate}%;"></div></div>
        </div>
        <div class="profile-meta">
          <div class="profile-meta-row"><span>‚è±Ô∏è</span>${s.exp} <span data-i18n="experience">experience</span></div>
          <div class="profile-meta-row"><span>üìû</span>${s.contact}</div>
          <div class="profile-meta-row"><span>üíª</span>${s.active ? '<span style="color:var(--color-success);">‚óè Online now</span>' : '<span style="color:var(--color-text-secondary);">‚óè Offline</span>'}</div>
        </div>
        <div class="profile-actions">
          <div class="profile-btn primary ${currentRole === 'Nagar Sevak' ? 'role-hide-ns' : ''}" onclick="showToast('üìã','Assigning to '+nagarsevaks[${nagarsevaks.indexOf(s)}].name,'Opening complaint assignment...','var(--color-primary)')" data-i18n="assignCase">Assign Case</div>
          <div class="profile-btn secondary" onclick="showToast('üìû','Contacting '+nagarsevaks[${nagarsevaks.indexOf(s)}].name,'Call feature coming soon!','var(--color-secondary)')" data-i18n="contact">Contact</div>
        </div>
      </div>
    </div>
  `).join('');
}

function buildBASliders() {
  const grid = document.getElementById('baGrid');
  if (!grid) return;
  grid.innerHTML = baData.map((d, i) => `
    <div class="ba-card">
      <div class="ba-header">
        <div><div class="ba-title">${d.title}</div><div class="ba-meta">${d.sub}</div></div>
        <div class="ba-resolved" data-i18n="resolved">‚úÖ Resolved</div>
      </div>
      <div class="slider-container" id="slider${i}" onmousemove="slideBA(event, ${i})" ontouchmove="slideBATouchMove(event, ${i})">
        <div class="slider-after">
          <div style="text-align:center;"><div style="font-size:48px;">${d.after}</div><div style="font-size:0.7rem;color:var(--color-text-secondary);margin-top:6px;" data-i18n="afterRepair">AFTER REPAIR</div></div>
        </div>
        <div class="slider-before" id="before${i}">
          <div style="text-align:center;"><div style="font-size:48px;">${d.before}</div><div style="font-size:0.7rem;color:var(--color-text-secondary);margin-top:6px;" data-i18n="before">BEFORE</div></div>
        </div>
        <div class="slider-label label-before" data-i18n="before">BEFORE</div>
        <div class="slider-label label-after" data-i18n="after">AFTER</div>
        <div class="slider-divider" id="divider${i}"></div>
        <div class="slider-handle" id="handle${i}">‚áî</div>
      </div>
      <div class="ba-footer">
        <div class="ba-officer"><div class="ba-officer-dot">üëÆ</div><span data-i18n="fixedBy">Fixed by:</span> ${d.officer}</div>
        <div class="ba-date">üìÖ ${d.date}</div>
      </div>
    </div>
  `).join('');
}

function slideBA(e, i) { /* same as original */ }
function slideBATouchMove(e, i) { /* same */ }

function buildPerformance() {
  const list = document.getElementById('officerList');
  if (!list) return;
  const sorted = [...nagarsevaks].sort((a,b) => b.rate - a.rate);
  list.innerHTML = sorted.map((s, i) => `
    <div class="officer-row">
      <div class="officer-rank ${['r1','r2','r3','','',''][i]}">${['ü•á','ü•à','ü•â','4','5','6'][i]}</div>
      <div class="officer-av">${s.emoji}</div>
      <div class="officer-info"><div class="officer-name">${s.name}</div><div class="officer-ward">${s.ward}</div></div>
      <div class="officer-bar-wrap"><div class="officer-bar" style="width:${s.rate}%;background:${s.color};"></div></div>
      <div class="officer-pct">${s.rate}%</div>
    </div>
  `).join('');

  const summ = document.getElementById('perfSummary');
  const items = [
    { label:'Total Complaints Filed', val:'197', icon:'üìã', color:'var(--color-primary)' },
    { label:'Resolved This Month', val:'172', icon:'‚úÖ', color:'var(--color-success)' },
    { label:'Emergency Cases', val:'5', icon:'üö®', color:'var(--color-critical)' },
    { label:'Avg Response Time', val:'3.2 days', icon:'‚ö°', color:'var(--color-warning)' },
  ];
  summ.innerHTML = items.map(it => `
    <div style="display:flex;align-items:center;gap:10px;padding:10px;background:var(--color-card);border-radius:8px;border:1px solid var(--border-light);">
      <div style="width:36px;height:36px;border-radius:8px;background:${it.color}20;display:flex;align-items:center;justify-content:center;font-size:16px;color:${it.color};">${it.icon}</div>
      <div style="flex:1;font-size:0.82rem;color:var(--color-text-secondary);">${it.label}</div>
      <div style="font-weight:800;color:${it.color};font-size:1rem;">${it.val}</div>
    </div>
  `).join('');

  const wardPerf = document.getElementById('wardPerf');
  const wards = [
    { name:'R-North (Borivali W)', rate:91, complaints:82 },
    { name:'R-Central (Borivali E)', rate:87, complaints:68 },
    { name:'R-South (Dahisar)', rate:82, complaints:29 },
    { name:'Ward S (Kandivali)', rate:93, complaints:18 },
  ];
  wardPerf.innerHTML = wards.map(w => `
    <div>
      <div style="display:flex;justify-content:space-between;font-size:0.78rem;margin-bottom:4px;">
        <span style="color:var(--color-text-secondary);">${w.name}</span>
        <span style="color:var(--color-text-primary);font-weight:700;">${w.rate}%</span>
      </div>
      <div style="height:6px;background:var(--border-light);border-radius:3px;overflow:hidden;">
        <div style="height:100%;width:${w.rate}%;background:var(--color-primary);border-radius:3px;"></div>
      </div>
    </div>
  `).join('');
}

function buildMapPins() {
  const container = document.getElementById('mapPins');
  if (!container) return;
  const pins = [
    { top:'28%', left:'18%', color:'var(--color-primary)', label:'üíß', complaint:'NS-2025-00892' },
    { top:'42%', left:'33%', color:'var(--color-critical)', label:'üõ£Ô∏è', complaint:'NS-2025-00891' },
    { top:'18%', left:'52%', color:'var(--color-success)', label:'üóëÔ∏è', complaint:'NS-2025-00890' },
    { top:'55%', left:'68%', color:'var(--color-warning)', label:'üí°', complaint:'NS-2025-00889' },
    { top:'35%', left:'76%', color:'var(--color-warning)', label:'üåä', complaint:'NS-2025-00888' },
    { top:'62%', left:'22%', color:'var(--color-warning)', label:'‚ö°', complaint:'NS-2025-00887' },
    { top:'72%', left:'44%', color:'var(--color-critical)', label:'üõ£Ô∏è', complaint:'NS-2025-00886' },
    { top:'25%', left:'65%', color:'var(--color-primary)', label:'üíß', complaint:'NS-2025-00883' },
  ];
  container.innerHTML = pins.map(p => `
    <div title="${p.complaint}" onclick="showToast('üìç','${p.complaint}','Click View in Complaints panel for details','${p.color}')"
      style="position:absolute;top:${p.top};left:${p.left};width:32px;height:32px;
        border-radius:50% 50% 50% 0;transform:rotate(-45deg);
        background:${p.color};cursor:pointer;
        box-shadow:0 4px 12px rgba(0,0,0,0.2);
        display:flex;align-items:center;justify-content:center;
        font-size:12px;transition:transform 0.2s;
        animation:pinBounce 0.6s ease-out both;"
      onmouseenter="this.style.transform='rotate(-45deg) scale(1.3)'"
      onmouseleave="this.style.transform='rotate(-45deg) scale(1)'">
      <span style="transform:rotate(45deg)">${p.label}</span>
    </div>
  `).join('');
}

function viewComplaint(idx) {
  const c = complaints[idx];
  document.getElementById('modalTitle').textContent = 'üìã Complaint Details ‚Äì ' + c.id;
  document.getElementById('modalBody').innerHTML = `
    <div class="detail-row"><span class="detail-label" data-i18n="id">ID</span><span class="detail-val"><strong style="color:var(--color-primary)">${c.id}</strong>${c.emergency ? ' <span style="background:var(--color-critical);color:white;padding:2px 8px;border-radius:4px;font-size:0.72rem;font-weight:700;">üö® EMERGENCY</span>' : ''}</span></div>
    <div class="detail-row"><span class="detail-label" data-i18n="title">Title</span><span class="detail-val">${c.title}</span></div>
    <div class="detail-row"><span class="detail-label" data-i18n="category">Category</span><span class="detail-val">${c.cat}</span></div>
    <div class="detail-row"><span class="detail-label" data-i18n="location">Location</span><span class="detail-val">üìç ${c.loc} ¬∑ <a href="https://maps.google.com/?q=Borivali+${c.loc.replace(/ /g,'+')},Mumbai" target="_blank" style="color:var(--color-primary);">Open in Maps ‚Üó</a></span></div>
    <div class="detail-row"><span class="detail-label" data-i18n="ward">Ward</span><span class="detail-val">${c.ward}</span></div>
    <div class="detail-row"><span class="detail-label" data-i18n="priority">Priority</span><span class="detail-val"><span class="priority-dot ${c.priority}" style="display:inline-block;width:10px;height:10px;border-radius:50;"></span> ${c.priority}</span></div>
    <div class="detail-row"><span class="detail-label" data-i18n="status">Status</span><span class="detail-val"><span class="status-pill ${c.status}">${getStatusLabel(c.status)}</span></span></div>
    <div class="detail-row"><span class="detail-label" data-i18n="citizen">Citizen</span><span class="detail-val">üë§ ${c.citizen}</span></div>
    <div class="detail-row"><span class="detail-label" data-i18n="dateFiled">Date Filed</span><span class="detail-val">üìÖ ${c.date}</span></div>
    <div style="margin-top:16px;">
      <div style="font-size:0.75rem;font-weight:700;color:var(--color-text-secondary);text-transform:uppercase;letter-spacing:0.08em;margin-bottom:8px;" data-i18n="updateStatus">Update Status</div>
      <select class="assign-select" id="statusUpdate">
        <option value="reported" ${c.status==='reported'?'selected':''}>üîµ New / Reported</option>
        <option value="assigned" ${c.status==='assigned'?'selected':''}>üü° Assigned</option>
        <option value="progress" ${c.status==='progress'?'selected':''}>üü£ In Progress</option>
        <option value="resolved" ${c.status==='resolved'?'selected':''}>üü¢ Resolved</option>
      </select>
    </div>
    <div class="modal-actions">
      <button class="modal-btn confirm" onclick="updateStatus(${idx})" data-i18n="saveChanges">üíæ Save Changes</button>
      <button class="modal-btn cancel" onclick="closeModal()" data-i18n="cancel">Cancel</button>
    </div>
  `;
  document.getElementById('modalOverlay').classList.add('open');
}

function openAssign(idx) {
  const c = complaints[idx];
  document.getElementById('modalTitle').textContent = 'üëÆ Assign ‚Äì ' + c.id;
  document.getElementById('modalBody').innerHTML = `
    <div style="margin-bottom:16px;padding:12px;background:var(--color-card);border-radius:8px;border:1px solid var(--border-light);">
      <div style="font-size:0.82rem;color:var(--color-text-secondary);margin-bottom:4px;">${c.cat} ¬∑ ${c.loc}</div>
      <div style="font-weight:600;color:var(--color-text-primary);">${c.title}</div>
    </div>
    <div style="font-size:0.75rem;font-weight:700;color:var(--color-text-secondary);text-transform:uppercase;letter-spacing:0.08em;margin-bottom:8px;" data-i18n="assignTo">Assign to Nagar Sevak</div>
    <select class="assign-select" id="sevakSelect">
      ${nagarsevaks.map(s => `<option>${s.name} ‚Äì ${s.ward} (${s.rate}% success)</option>`).join('')}
    </select>
    <div style="font-size:0.75rem;font-weight:700;color:var(--color-text-secondary);text-transform:uppercase;letter-spacing:0.08em;margin-bottom:8px;" data-i18n="setPriority">Set Priority</div>
    <select class="assign-select">
      <option ${c.priority==='high'?'selected':''}>üî¥ High</option>
      <option ${c.priority==='medium'?'selected':''}>üü° Medium</option>
      <option ${c.priority==='low'?'selected':''}>üü¢ Low</option>
    </select>
    <div class="modal-actions">
      <button class="modal-btn confirm" onclick="closeModal();showToast('üëÆ','Complaint Assigned!','Auto-notifying the Nagar Sevak via SMS','var(--color-success)')" data-i18n="assignNow">‚úÖ Assign Now</button>
      <button class="modal-btn cancel" onclick="closeModal()" data-i18n="cancel">Cancel</button>
    </div>
  `;
  document.getElementById('modalOverlay').classList.add('open');
}

function updateStatus(idx) {
  const newStatus = document.getElementById('statusUpdate').value;
  complaints[idx].status = newStatus;
  closeModal();
  buildComplaintTable(complaints);
  buildRecentTable();
  showToast('‚úÖ', 'Status updated!', complaints[idx].id + ' ‚Üí ' + getStatusLabel(newStatus), 'var(--color-success)');
}

function closeModal(e) {
  if (e && e.target !== document.getElementById('modalOverlay')) return;
  document.getElementById('modalOverlay').classList.remove('open');
}

function switchPanel(name, el) {
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.getElementById('panel-' + name).classList.add('active');
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  if (el) el.classList.add('active');

  // If switching to map panel, initialize or refresh the map
  if (name === 'map') {
    initAdminMap();
  }

  const titles = { 
    dashboard:'Dashboard Overview', 
    complaints:'Complaint Management', 
    map:'Live Map', 
    profiles:'Nagar Sevak Profiles', 
    baslider:'Before & After Comparisons', 
    performance:'Performance Analytics', 
    settings:'System Settings' 
  };
  document.getElementById('pageTitle').textContent = titles[name] || 'Dashboard';
  document.getElementById('pageBreadcrumb').textContent = titles[name] || 'Dashboard';
  document.getElementById('sidebar').classList.remove('open');
}
function toggleNotif() {
  const p = document.getElementById('notifPanel');
  p.classList.toggle('open');
}
function markAllRead(e) {
  e.stopPropagation();
  document.querySelectorAll('.notif-item.unread').forEach(n => n.classList.remove('unread'));
  document.querySelector('.tb-notif-dot').style.display = 'none';
  document.getElementById('notifPanel').classList.remove('open');
  showToast('‚úÖ','All notifications read','Inbox cleared','var(--color-success)');
}
document.addEventListener('click', e => {
  const p = document.getElementById('notifPanel');
  if (p && !p.contains(e.target) && !e.target.closest('.tb-btn')) p.classList.remove('open');
});

function setChip(el) {
  el.closest('.card-actions').querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
  el.classList.add('active');
}

function showToast(icon, msg, sub, color = 'var(--color-success)') {
  const t = document.getElementById('toast');
  document.getElementById('toastIcon').textContent = icon;
  document.getElementById('toastMsg').textContent = msg;
  document.getElementById('toastSub').textContent = sub;
  t.style.borderLeft = '3px solid ' + color;
  t.classList.add('show');
  clearTimeout(t._t);
  t._t = setTimeout(() => t.classList.remove('show'), 4000);
}

const styleEl = document.createElement('style');
styleEl.textContent = '@keyframes pinBounce{from{opacity:0;transform:rotate(-45deg) translateY(-20px)}to{opacity:1;transform:rotate(-45deg) translateY(0)}}';
document.head.appendChild(styleEl);

// ===== ADMIN MAP (Leaflet) =====
// ===== ADMIN MAP (Leaflet) with Layer Control =====
let adminMap = null;

function initAdminMap() {
  if (adminMap) {
    setTimeout(() => adminMap.invalidateSize(), 200);
    return;
  }

  // Initialize map
  adminMap = L.map('adminMap').setView([19.231, 72.857], 13);

  // ---- Base Layers ----
  const streetLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>, &copy; CartoDB'
  });

  const satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
    attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
  });

  // Add default street layer
  streetLayer.addTo(adminMap);

  // Add layer control so user can switch
  L.control.layers({
    "Street Map": streetLayer,
    "Satellite": satelliteLayer
  }).addTo(adminMap);

  // ---- Borivali Boundary Polygon ----
  L.polygon([
    [19.265, 72.825], [19.276, 72.835], [19.280, 72.850],
    [19.275, 72.870], [19.260, 72.885], [19.240, 72.895],
    [19.215, 72.890], [19.195, 72.875], [19.185, 72.860],
    [19.180, 72.840], [19.190, 72.825], [19.210, 72.820],
    [19.230, 72.818], [19.250, 72.820], [19.265, 72.825]
  ], {
    color: '#2563EB',
    weight: 3,
    opacity: 0.8,
    fillOpacity: 0.1
  }).addTo(adminMap);

  // ---- Complaint Markers ----
  complaints.forEach(complaint => {
    // Assign approximate coordinates based on location text
    let lat, lng;
    if (complaint.loc.includes('Link Road')) { lat = 19.236; lng = 72.848; }
    else if (complaint.loc.includes('SV Road')) { lat = 19.242; lng = 72.866; }
    else if (complaint.loc.includes('Shimpoli')) { lat = 19.214; lng = 72.842; }
    else if (complaint.loc.includes('IC Colony')) { lat = 19.223; lng = 72.828; }
    else if (complaint.loc.includes('Borivali Station')) { lat = 19.231; lng = 72.857; }
    else if (complaint.loc.includes('Eksar')) { lat = 19.191; lng = 72.835; }
    else if (complaint.loc.includes('Mandapeshwar')) { lat = 19.204; lng = 72.851; }
    else if (complaint.loc.includes('Station Road')) { lat = 19.240; lng = 72.860; }
    else { 
      // fallback: random point within Borivali bounds
      lat = 19.21 + Math.random() * 0.07;
      lng = 72.83 + Math.random() * 0.06;
    }

    const color = getCategoryColor(complaint.catKey);
    L.circleMarker([lat, lng], {
      radius: 8,
      fillColor: color,
      color: '#fff',
      weight: 2,
      fillOpacity: 0.9
    })
    .addTo(adminMap)
    .bindPopup(`
      <b>${complaint.id}</b><br>
      ${complaint.title}<br>
      <span style="color:${color};">${complaint.cat}</span><br>
      Status: ${complaint.status}<br>
      ${complaint.loc}
    `);
  });
}

// Helper to get category color (matches the legend)
function getCategoryColor(cat) {
  const map = {
    water: '#2563EB',       // Water
    electricity: '#F59E0B', // Electricity
    roads: '#EF4444',       // Roads
    garbage: '#22C55E',     // Garbage
    safety: '#475569',      // (used for Other in legend)
    streetlight: '#D97706',
    drainage: '#7C3AED',
    other: '#475569'        // Other
  };
  return map[cat] || '#475569';
}

// Helper to get category color (copy from existing or use mapping)
function getCategoryColor(cat) {
  const map = {
    water: '#2563EB',
    electricity: '#F59E0B',
    roads: '#EF4444',
    garbage: '#22C55E',
    safety: '#475569',
    streetlight: '#D97706',
    drainage: '#7C3AED',
    other: '#475569'
  };
  return map[cat] || '#475569';
}
</script>
</body>
</html>